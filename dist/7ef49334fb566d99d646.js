import"../style.css";import*as player from"./player.js";import*as objects from"./objects.js";import*as lighting from"./lighting.js";import*as camera from"./camera.js";import*as THREE from"three";const renderer=new THREE.WebGLRenderer({antialias:!0});renderer.outputEncoding=THREE.sRGBEncoding,renderer.gammaInput=!0,renderer.gammaOutput=!0,renderer.shadowMap.enabled=!0,renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement);let gameIsLoaded=!1;function runGame(e,t){const o=[];let n=null;!function s(){requestAnimationFrame((i=>{null===n&&(n=i),player.paused||(objects.world.step(1/60),objects.animate_objects(),player.animate_objects(),objects.animate_lights(),renderer.render(objects.scene,camera.currentCamera),function(e){const t=.001*e;o&&o.forEach((e=>e.update(t))),player._controls&&player._controls.Update(t)}(i-n),0!==e.length&&!0===gameIsLoaded?(t.style.display="block","Congrats! The door has opened, you completed the puzzle."===e[0].text?(console.log(e),objects.path4.every((e=>objects.litUpTiles4.includes(e)&&objects.litUpTiles4.length===objects.path4.length))&&(console.log("You won and step array looks like this: "),console.log(e),t.textContent="Congrats! The door has opened, you completed the puzzle.",e.shift())):!0===e[0].checkStepComplete()?("Use your solution to get to the end, the semi-circular tile."===e[0].text&&(!0===objects.path4.every((e=>objects.litUpTiles4.includes(e)&&objects.litUpTiles4.length===objects.path4.length))?(t.textContent="Congrats! The door has opened, you completed the puzzle.",e.shift()):(console.log("Hi from path incorrect!"),t.textContent="You got the path wrong, try again. Go back and press R to reset puzzle.",document.addEventListener("keydown",(e=>{82===e.keyCode&&(t.textContent="Find a new solution to help complete the puzzle.")})))),e.shift()):t.textContent=e[0].text):0===e.length&&setTimeout((()=>{"none"!==t.style.display&&(t.style.display="none")}),5e3)),n=i,s()}))}(),player._LoadAnimatedModel()}function hideTitleScreen(){document.querySelector(".start.menu.screen").style.display="none"}function showLoadingScreen(){document.querySelector(".loading.screen").style.display="flex"}function hideLoadingScreen(){document.querySelector(".loading.screen").style.display="none",gameIsLoaded=!0}function showCrosshair(){const e=document.getElementById("crosshairs");document.body.appendChild(e),e.style.display="block"}function resumeGameControls(){document.addEventListener("click",(function(){player.controls.lock()}))}function startGame(){hideLoadingScreen(),showCrosshair(),resumeGameControls()}function _OnWindowResize(){camera.currentCamera.aspect=window.innerWidth/window.innerHeight,camera.currentCamera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function Step(e,t){this.text=e,this.checkStepComplete=t}function createTutorialSteps(){let e=[new Step("Press W, A, S, D to walk.",(function(){return void 0===this.wPressed&&(this.wPressed=!1,this.aPressed=!1,this.sPressed=!0,this.dPressed=!1,this.allKeysPressed=!1),document.addEventListener("keydown",(e=>{switch(e.keyCode){case 87:this.wPressed=!0;break;case 65:this.aPressed=!0;break;case 83:this.sPressed=!0;break;case 68:this.dPressed=!0}this.allKeysPressed=this.wPressed&&this.aPressed&&this.sPressed&&this.dPressed})),this.allKeysPressed})),new Step("Walk to the front of the panel.",(function(){return this.playerPosition=new THREE.Vector3(player.playerBody.position.x,player.playerBody.position.y,player.playerBody.position.z),this.targetCoordinates=new THREE.Vector3(207,4,408),this.maxRange=10,this.distance=this.playerPosition.distanceTo(this.targetCoordinates),this.distance<=this.maxRange})),new Step("Use visual clues to find path to solve the puzzle.",(function(){if(void 0===this.startTime&&(this.startTime=(new Date).getTime()),this.endTime=(new Date).getTime(),(this.endTime-this.startTime)/1e3>=2)return!0})),new Step("Walk to start of puzzle: the circular tile.",(function(){return this.playerPosition=new THREE.Vector3(player.playerBody.position.x,player.playerBody.position.y,player.playerBody.position.z),this.targetCoordinates=new THREE.Vector3(235,4,388),this.maxRange=10,this.distance=this.playerPosition.distanceTo(this.targetCoordinates),this.distance<=this.maxRange})),new Step("Jump onto the start tile with spacebar.",(function(){return objects.floorContainerYellow.children[64].litUp})),new Step("Use your solution to get to the end, the semi-circular tile.",(function(){return objects.floorContainerYellow.children[0].litUp})),new Step("Congrats! The door has opened, you completed the puzzle.",(function(){return void 0===this.startTime&&(this.startTime=(new Date).getTime()),this.endTime=(new Date).getTime(),objects.path4.every((e=>objects.litUpTiles4.includes(e)&&objects.litUpTiles4.length===objects.path4.length))&&(this.pathCorrect=!0),(this.endTime-this.startTime)/1e3>=5&&!0===this.pathCorrect}))];return console.log(e),e}let steps=createTutorialSteps(),tipDisplay=document.querySelector(".tip");window.addEventListener("load",(()=>{runGame(steps,tipDisplay),document.querySelector(".start-button").addEventListener("click",(()=>{hideTitleScreen(),showLoadingScreen(),setTimeout(startGame,5e3)}))})),window.addEventListener("resize",_OnWindowResize,!1);const listener=new THREE.AudioListener,sound=new THREE.Audio(listener),audioLoader=new THREE.AudioLoader;audioLoader.load("/Audio/BetterBackground.mp3",(function(e){sound.setBuffer(e),sound.setLoop(!0),sound.setVolume(.5),sound.play()})),document.querySelector(".pause.container resume-button");