import*as THREE from"three";import*as CANNON from"cannon-es";import woodTextureImage from"../img/woodenfloor.jpg";import walltextureImage from"../img/wall.jpg";import ceilingtextureImage from"../img/Ceiling.jpg";import*as camera from"./camera.js";export const scene=new THREE.Scene;export var world=new CANNON.World({gravity:new CANNON.Vec3(0,-9.81,0)});const axesHelper=new THREE.AxesHelper(50);scene.add(axesHelper);const boxGeo=new THREE.BoxGeometry(2,2,2),boxMat=new THREE.MeshBasicMaterial({color:65280,wireframe:!0}),boxMesh=new THREE.Mesh(boxGeo,boxMat);scene.add(boxMesh);const groundGeo=new THREE.PlaneGeometry(70,80),groundMat=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,wireframe:!0});export const groundMesh=new THREE.Mesh(groundGeo,groundMat);scene.add(groundMesh);const groundBody=new CANNON.Body({shape:new CANNON.Plane,type:CANNON.Body.STATIC});groundBody.quaternion.setFromEuler(-Math.PI/2,0,0),groundBody.position.y-=30,world.addBody(groundBody);const tileGeometry=new THREE.BoxGeometry(5,5,1.3),tileMaterial=new THREE.MeshStandardMaterial({color:16777215,opacity:.5,transparent:!0}),tileSize=5,gapSize=.2,floorContainer=new THREE.Group,textureLoader=new THREE.TextureLoader,woodTexture=textureLoader.load(woodTextureImage),numRows=9,numCols=9,tiles=[];for(let e=0;e<9;e++)for(let o=0;o<9;o++)if(!(e%2==0&&o%2==0||e%2==1&&o%2==1)||e%4==0||(e-2)%4==0){const t=new THREE.Mesh(tileGeometry,tileMaterial.clone()),r=5.2*(e-4.5),n=5.2*(o-4.5);t.position.set(r,n,0),t.castShadow=!0,t.receiveShadow=!0,t.addEventListener("click",(()=>{changeTileColorOnClick(t)})),floorContainer.add(t),tiles.push(t)}function changeTileColorOnClick(e){const o=new THREE.Color(0,0,255);e.material.color.copy(o),tileMaterial.castShadow=!0,tileMaterial.receiveShadow=!0,tileMaterial.transparent=!0;const t=new THREE.PointLight(o,1,20,5);t.position.copy(e.position),scene.add(t)}floorContainer.scale.set(1.3,1.3,1.3);export const raycaster=new THREE.Raycaster;const mouse=new THREE.Vector2(0,0);document.addEventListener("click",(e=>{mouse.x=0,mouse.y=0,raycaster.setFromCamera(mouse,camera.currentCamera);const o=raycaster.intersectObjects(tiles);o.length>0&&o[0].object.dispatchEvent({type:"click"})})),tileMaterial.castShadow=!0,tileMaterial.receiveShadow=!0;const rotationAngle=Math.PI/2;floorContainer.rotation.set(-rotationAngle,0,0);const translationVector=new THREE.Vector3(0,-29.9,-10);floorContainer.position.copy(translationVector),scene.add(floorContainer);const floorWidth=9*5.2,floorHeight=9*5.2,floorGeometry=new THREE.PlaneGeometry(70,79.9),floorMaterial=new THREE.MeshStandardMaterial({map:woodTexture}),floor=new THREE.Mesh(floorGeometry,floorMaterial);floor.rotation.x=-Math.PI/2,floor.position.set(0,-29.99,0),scene.add(floor);const target=new THREE.Object3D;target.position.copy(floorContainer.position);export function animated_objects(){boxMesh.position.copy(boxBody.position),boxMesh.quaternion.copy(boxBody.quaternion),groundMesh.position.copy(groundBody.position),groundMesh.quaternion.copy(groundBody.quaternion)}